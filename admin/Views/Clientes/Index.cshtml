<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clientes - Barbería JK</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background-color: #f4f4f4;
        }
        

        .hero {
            height: 300px;
            background: linear-gradient(135deg, #111, #444);
        }

        .table-container {
            margin-top: 40px;
        }

        .card-custom {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .btn-warning {
            background-color: #f1c40f;
            border: none;
        }

            .btn-warning:hover {
                background-color: #d4ac0d;
            }

        .footer-custom {
            margin-top: 80px;
            padding: 40px;
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
            color: white;
            text-align: center;
        }

        .table thead {
            background-color: #111;
            color: white;
        }
    </style>
</head>
<body>

    <!-- HERO -->
    <div class="hero position-relative text-white text-center">
        <div style="position:absolute; inset:0; background-color: rgba(0,0,0,0.5);"></div>
        <div class="d-flex flex-column justify-content-center align-items-center h-100 position-relative">
            <h1 class="display-4 fw-bold">Gestión de Clientes</h1>
            <p class="lead">Administra los clientes de Barbería JK</p>
            <button class="btn btn-warning btn-lg mt-2" data-bs-toggle="modal" data-bs-target="#agregarClienteModal">
                Agregar Cliente
            </button>
        </div>
    </div>

    <!-- CONTENIDO -->
    <div class="container table-container">
        <div class="card card-custom p-4">
            <h3 class="fw-bold mb-3">Listado de clientes</h3>
            <div class="table-responsive">
                <table class="table table-striped table-hover" id="clientesTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Teléfono</th>
                            <th>Activo</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal Agregar Cliente -->
    <div class="modal fade" id="agregarClienteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title">Agregar Cliente</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formAgregarCliente">
                        <div class="mb-3">
                            <label class="form-label">Nombre</label>
                            <input type="text" class="form-control" id="nombreCliente" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Teléfono</label>
                            <input type="text" class="form-control" id="telefonoCliente" required>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="activoCliente" checked>
                            <label class="form-check-label">Activo</label>
                        </div>
                        <button type="submit" class="btn btn-primary w-100 mt-3">Guardar Cliente</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Editar Cliente -->
    <div class="modal fade" id="editarClienteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title">Editar Cliente</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formEditarCliente">
                        <input type="hidden" id="editarIdCliente">
                        <div class="mb-3">
                            <label class="form-label">Nombre</label>
                            <input type="text" class="form-control" id="editarNombreCliente" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Teléfono</label>
                            <input type="text" class="form-control" id="editarTelefonoCliente" required>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="editarActivoCliente">
                            <label class="form-check-label">Activo</label>
                        </div>
                        <button type="submit" class="btn btn-primary w-100 mt-3">Actualizar Cliente</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Script clientes -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            cargarClientes();

            const agregarModalEl = document.getElementById('agregarClienteModal');
            const editarModalEl = document.getElementById('editarClienteModal');

            // Agregar cliente
            document.getElementById('formAgregarCliente').addEventListener('submit', async e => {
                e.preventDefault();
                const nombre = nombreCliente.value;
                const telefono = telefonoCliente.value;
                const activo = activoCliente.checked;

                try {
                    const res = await fetch('https://localhost:7106/api/cliente', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ nombre, telefono, activo })
                    });
                    if(!res.ok) throw new Error();

                    bootstrap.Modal.getOrCreateInstance(agregarModalEl).hide();
                    formAgregarCliente.reset();
                    cargarClientes();
                    alert('Cliente agregado correctamente');
                } catch {
                    bootstrap.Modal.getOrCreateInstance(agregarModalEl).hide();
                    alert('No se pudo agregar el cliente');
                }
            });

            // Editar cliente //
            document.getElementById('formEditarCliente').addEventListener('submit', async e => {
                e.preventDefault();
                const id = editarIdCliente.value;
                const data = {
                    idCliente: parseInt(id),
                    nombre: editarNombreCliente.value,
                    telefono: editarTelefonoCliente.value,
                    activo: editarActivoCliente.checked
                };

                try {
                    const res = await fetch(`https://localhost:7106/api/cliente/${id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    if(!res.ok) throw new Error();

                    bootstrap.Modal.getOrCreateInstance(editarModalEl).hide();
                    cargarClientes();
                    alert('Cliente actualizado correctamente');
                } catch {
                    bootstrap.Modal.getOrCreateInstance(editarModalEl).hide();
                    alert('No se pudo actualizar el cliente');
                }
            });
        });

        // Cargar clientes
        async function cargarClientes() {
            try {
                const res = await fetch('https://localhost:7106/api/cliente');
                if(!res.ok) throw new Error('Error al obtener clientes');
                const clientes = await res.json();

                const tbody = document.querySelector('#clientesTable tbody');
                tbody.innerHTML = '';

                clientes.forEach(cliente => {
                    tbody.innerHTML += `
                        <tr>
                            <td>${cliente.idCliente}</td>
                            <td>${cliente.nombre}</td>
                            <td>${cliente.telefono}</td>
                            <td>${cliente.activo ? 'Sí' : 'No'}</td>
                            <td>
                                <button class="btn btn-warning btn-sm" onclick="abrirEditarCliente(${cliente.idCliente}, '${cliente.nombre}', '${cliente.telefono}', ${cliente.activo})">Editar</button>
                                ${cliente.activo
                                    ? `<button class="btn btn-danger btn-sm" onclick="desactivarCliente(${cliente.idCliente})">Eliminar</button>`
                                    : `<button class="btn btn-success btn-sm" onclick="activarCliente(${cliente.idCliente})">Activar</button>`}
                            </td>
                        </tr>
                    `;
                });
            } catch (err) {
                console.error(err);
                alert('No se pudieron cargar los clientes');
            }
        }

        function abrirEditarCliente(id, nombre, telefono, activo) {
            editarIdCliente.value = id;
            editarNombreCliente.value = nombre;
            editarTelefonoCliente.value = telefono;
            editarActivoCliente.checked = activo;
            bootstrap.Modal.getOrCreateInstance(document.getElementById('editarClienteModal')).show();
        }

        async function desactivarCliente(id) {
            if(!confirm('¿Estás seguro de desactivar este cliente?')) return;
            await fetch(`https://localhost:7106/api/cliente/${id}`, { method:'DELETE' });
            cargarClientes();
        }

        async function activarCliente(id) {
            if(!confirm('¿Estás seguro de activar este cliente?')) return;
            await fetch(`https://localhost:7106/api/cliente/${id}/activar`, { method:'PUT' });
            cargarClientes();
        }
    </script>

</body>
</html>
